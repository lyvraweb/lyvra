<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Painel — Lyvra</title>

<link rel="icon" type="image/png" href="assets/favicon.png">

<style>
* {
  box-sizing: border-box;
}

body {
  margin: 0;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
  background: #f7f7f8;
  color: #111827;
}

/* HEADER */
.header {
  height: 60px;
  background: white;
  border-bottom: 1px solid #e5e7eb;
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0 20px;
}

.header-left {
  display: flex;
  align-items: center;
  gap: 10px;
}

.header-left img {
  height: 28px;
}

.plan-badge {
  font-size: 0.8rem;
  padding: 4px 10px;
  border-radius: 999px;
  background: #eef2ff;
  color: #3730a3;
}

.header-right {
  display: flex;
  gap: 12px;
}

.header-right button {
  background: none;
  border: none;
  font-size: 0.9rem;
  cursor: pointer;
  color: #2563eb;
}

/* MAIN */
.main {
  max-width: 820px;
  margin: 40px auto;
  padding: 0 20px;
}

h1 {
  font-size: 1.8rem;
  margin-bottom: 8px;
}

.sub {
  color: #6b7280;
  margin-bottom: 30px;
}

/* FORM */
.card {
  background: white;
  border: 1px solid #e5e7eb;
  border-radius: 12px;
  padding: 24px;
}

.form-group {
  margin-bottom: 18px;
}

label {
  font-size: 0.9rem;
  color: #374151;
  display: block;
  margin-bottom: 6px;
}

input, select {
  width: 100%;
  padding: 12px;
  border-radius: 8px;
  border: 1px solid #d1d5db;
  font-size: 0.95rem;
}

button.generate {
  width: 100%;
  margin-top: 10px;
  background: #111827;
  color: white;
  padding: 14px;
  border-radius: 10px;
  border: none;
  font-size: 1rem;
  cursor: pointer;
}

/* RESULT */
.result {
  margin-top: 30px;
  display: none;
}

.result h2 {
  font-size: 1.2rem;
  margin-bottom: 10px;
}

.result-box {
  background: #f9fafb;
  border: 1px solid #e5e7eb;
  border-radius: 12px;
  padding: 18px;
  margin-bottom: 15px;
}

/* IMAGE + WATERMARK */
.image-wrapper {
  position: relative;
  margin-top: 12px;
}

.image-wrapper img {
  width: 100%;
  border-radius: 12px;
}

.watermark {
  position: absolute;
  bottom: 10px;
  right: 10px;
  background: rgba(0,0,0,0.45);
  color: #fff;
  font-size: 12px;
  padding: 6px 10px;
  border-radius: 8px;
  display: none;
  pointer-events: none;
}

/* UPGRADE */
.upgrade {
  margin-top: 20px;
  background: #eef2ff;
  border: 1px dashed #6366f1;
  padding: 16px;
  border-radius: 12px;
  font-size: 0.9rem;
}

.upgrade a {
  color: #4f46e5;
  font-weight: bold;
  text-decoration: none;
}

/* FOOTER SPACE */
.footer-space {
  height: 80px;
}

.spinner {
  width: 18px;
  height: 18px;
  border: 3px solid #e5e7eb;
  border-top: 3px solid #111827;
  border-radius: 50%;
  animation: spin 0.9s linear infinite;
}

@keyframes spin {
  to {
    transform: rotate(360deg);
  }
}
  
</style>
</head>

<body>

<!-- HEADER -->
<div class="header">
  <div class="header-left">
    <img src="assets/logo.png" alt="Lyvra">
    <div class="plan-badge" id="user-plan">
      Plano Free • <span id="usageCount">0</span> / <span id="usageLimit">3</span>
    </div>
  </div>

  <div class="header-right">
    <button id="upgradeBtn">Upgrade</button>
    <button id="logoutBtn">Sair</button>
  </div>
</div>

<!-- MAIN -->
<div class="main">

  <h1>Gerar conteúdo para Instagram</h1>
  <p class="sub">Ideias, copy e imagem em segundos com IA</p>

  <div class="card">

    <div class="form-group">
      <label>Nicho</label>
      <input type="text" id="niche" placeholder="Ex: marketing digital, fitness, moda feminina">
    </div>

    <div class="form-group">
      <label>Objetivo do post</label>
      <select id="goal">
        <option value="engajamento">Engajamento</option>
        <option value="vendas">Vendas</option>
        <option value="autoridade">Autoridade</option>
      </select>
    </div>

    <button class="generate" id="generateBtn">Gerar conteúdo com IA</button>
    <div id="loadingBox" style="display:none; margin-top:20px;">
  <div style="display:flex; align-items:center; gap:10px;">
    <div class="spinner"></div>
    <span id="loadingText">Lyvra está criando seu conteúdo...</span>
  </div>
</div>

  </div>

  <!-- RESULT -->
  <div class="result" id="result">
    <h2>Resultado</h2>

    <div class="result-box">
      <strong>Ideia:</strong>
      <p id="ideaText"></p>
    </div>

    <div class="result-box">
      <strong>Legenda:</strong>
      <p id="copyText"></p>
    </div>

    <div class="result-box">
      <strong>Imagem:</strong>

      <div class="image-wrapper">
        <img id="imagePreview" />
        <div class="watermark" id="watermark">Criado com Lyvra AI</div>
      </div>
    </div>

    <div class="upgrade" id="upgradeBox">
      Você está usando o plano Free.  
      <a href="/planos.html">Desbloqueie mais recursos no plano Pro</a>
    </div>

  </div>

</div>

<div class="footer-space"></div>

<script>
/* ===== ELEMENTOS ===== */
const generateBtn = document.getElementById("generateBtn");
const loadingBox = document.getElementById("loadingBox");
const resultBox = document.getElementById("result");
const usageCountEl = document.getElementById("usageCount");
const usageLimitEl = document.getElementById("usageLimit");
const upgradeBox = document.getElementById("upgradeBox");

/* ===== MOCK TEMPORÁRIO (depois vem do Firebase) ===== */
const urlPlan = getPlanFromURL();

const user = {
  uid: localStorage.getItem("lyvra_uid") || ("uid_" + Math.random().toString(36).slice(2)),
  plan: urlPlan || localStorage.getItem("lyvra_plan") || "free"
};

localStorage.setItem("lyvra_uid", user.uid);
localStorage.setItem("lyvra_plan", user.plan);

  document.getElementById("user-plan").innerText =
  `Plano ${user.plan.charAt(0).toUpperCase() + user.plan.slice(1)} • `;


  function getPlanFromURL() {
  const params = new URLSearchParams(window.location.search);
  return params.get("plan");
}


localStorage.setItem("lyvra_uid", user.uid);
localStorage.setItem("lyvra_plan", user.plan);

/* ===== LIMITES ===== */
const limits = {
  free: 3,
  pro: 300,
  business: Infinity
};

const usageKey = `lyvra_usage_${user.uid}`;
let usageCount = parseInt(localStorage.getItem(usageKey)) || 0;
const usageLimit = limits[user.plan];

/* ===== UI INICIAL ===== */
usageLimitEl.innerText = usageLimit === Infinity ? "∞" : usageLimit;
usageCountEl.innerText = usageCount;

/* ===== FUNÇÃO DE LIMITE ===== */
function checkLimit() {
  if (usageCount >= usageLimit) {
    generateBtn.disabled = true;
    generateBtn.innerText = "Limite atingido";
    upgradeBox.style.display = user.plan === "free" ? "block" : "none";
    return true;
  }

  generateBtn.disabled = false;
  generateBtn.innerText = "Gerar conteúdo com IA";
  upgradeBox.style.display = "none";
  return false;
}

checkLimit();

/* ===== EVENTO GERAR ===== */
generateBtn.addEventListener("click", async () => {
  if (checkLimit()) return;

  const niche = document.getElementById("niche").value.trim();
  if (!niche) {
    alert("Informe o nicho para gerar o conteúdo.");
    return;
  }

  generateBtn.disabled = true;
  generateBtn.innerText = "Gerando...";
  loadingBox.style.display = "block";
  resultBox.style.display = "none";

  await new Promise(r => setTimeout(r, 2000));

  document.getElementById("ideaText").innerText =
    "3 erros comuns que estão impedindo seu Instagram de crescer";

  document.getElementById("copyText").innerText =
    "Você está postando, mas não cresce porque pequenos erros estão sabotando seu alcance. Veja como corrigir agora.";

  document.getElementById("imagePreview").src =
    "https://via.placeholder.com/600x600.png?text=Imagem+Gerada+pela+IA";

  usageCount++;
  localStorage.setItem(usageKey, usageCount);
  usageCountEl.innerText = usageCount;

  loadingBox.style.display = "none";
  resultBox.style.display = "block";
  generateBtn.disabled = false;
  generateBtn.innerText = "Gerar conteúdo com IA";

  resultBox.scrollIntoView({ behavior: "smooth" });

  checkLimit();
});

/* ===== BOTÕES SEMPRE FUNCIONAIS ===== */
document.getElementById("logoutBtn").addEventListener("click", () => {
  localStorage.removeItem("lyvra_uid");
  window.location.href = "/index.html";
});

document.getElementById("upgradeBtn").addEventListener("click", () => {
  window.location.href = "/planos.html";
});
</script>
</body>
</html>
