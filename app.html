<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>App — Lyvra</title>

  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
</head>
<body>

<h1>Bem-vindo ao Lyvra</h1>
<p id="user-plan">Carregando...</p>
<button id="logoutBtn">Sair</button>
<script>
document.addEventListener("DOMContentLoaded", () => {

  /* ================= FIREBASE ================= */
  const firebaseConfig = {
    apiKey: "SUA_API_KEY",
    authDomain: "lyvra-e48a0.firebaseapp.com",
    projectId: "lyvra-e48a0"
  };

  if (!firebase.apps.length) {
    firebase.initializeApp(firebaseConfig);
  }

  const auth = firebase.auth();
  const db   = firebase.firestore();

  /* ================= ELEMENTOS ================= */
  const statusEl  = document.getElementById("user-plan");
  const logoutBtn = document.getElementById("logoutBtn");

  if (!statusEl || !logoutBtn) {
    console.error("Elementos do DOM não encontrados");
    return;
  }

  /* ================= AUTH ================= */
  auth.onAuthStateChanged(async (user) => {

    if (!user) {
      window.location.replace("/login.html");
      return;
    }

    try {
      const uid = user.uid;
      const ref = db.collection("users").doc(uid);
      const snap = await ref.get();

      let data;

      if (!snap.exists) {
        data = {
          email: user.email,
          name: user.displayName || "",
          plan: "free",
          createdAt: firebase.firestore.FieldValue.serverTimestamp()
        };
        await ref.set(data);
      } else {
        data = snap.data();
      }

      statusEl.innerText = `Plano ${data.plan.toUpperCase()}`;

    } catch (err) {
      console.error("Erro Firestore:", err);
      statusEl.innerText = "Erro ao carregar conta";
    }
  });

  /* ================= LOGOUT ================= */
  logoutBtn.addEventListener("click", async () => {
    await auth.signOut();
    window.location.replace("/login.html");
  });

});
</script>
</body>
</html>
