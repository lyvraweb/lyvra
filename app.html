<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Painel — Lyvra</title>

<link rel="icon" type="image/png" href="assets/favicon.png">

<style>
/* === ESTILOS (inalterados) === */
* { box-sizing: border-box; }
body {
  margin: 0;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
  background: #f7f7f8;
  color: #111827;
}
.header {
  height: 60px;
  background: white;
  border-bottom: 1px solid #e5e7eb;
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0 20px;
}
.header-left {
  display: flex;
  align-items: center;
  gap: 10px;
}
.header-left img { height: 28px; }
.plan-badge {
  font-size: 0.8rem;
  padding: 4px 10px;
  border-radius: 999px;
  background: #eef2ff;
  color: #3730a3;
}
.header-right {
  display: flex;
  gap: 12px;
}
.header-right button {
  background: none;
  border: none;
  font-size: 0.9rem;
  cursor: pointer;
  color: #2563eb;
}
.main {
  max-width: 820px;
  margin: 40px auto;
  padding: 0 20px;
}
.card {
  background: white;
  border: 1px solid #e5e7eb;
  border-radius: 12px;
  padding: 24px;
}
button.generate {
  width: 100%;
  margin-top: 10px;
  background: #111827;
  color: white;
  padding: 14px;
  border-radius: 10px;
  border: none;
  font-size: 1rem;
  cursor: pointer;
}
.result { margin-top: 30px; display: none; }
.image-wrapper { position: relative; margin-top: 12px; }
.image-wrapper img { width: 100%; border-radius: 12px; }
.watermark {
  position: absolute;
  bottom: 10px;
  right: 10px;
  background: rgba(0,0,0,0.45);
  color: #fff;
  font-size: 12px;
  padding: 6px 10px;
  border-radius: 8px;
  display: none;
  pointer-events: none;
}
.upgrade {
  margin-top: 20px;
  background: #eef2ff;
  border: 1px dashed #6366f1;
  padding: 16px;
  border-radius: 12px;
  font-size: 0.9rem;
}
.spinner {
  width: 18px;
  height: 18px;
  border: 3px solid #e5e7eb;
  border-top: 3px solid #111827;
  border-radius: 50%;
  animation: spin 0.9s linear infinite;
}
@keyframes spin { to { transform: rotate(360deg); } }
</style>
</head>

<body>

<div class="header">
  <div class="header-left">
    <img src="assets/logo.png">
    <div class="plan-badge" id="user-plan"></div>
  </div>
  <div class="header-right">
    <button id="upgradeBtn">Upgrade</button>
    <button id="logoutBtn">Sair</button>
  </div>
</div>

<div class="main">

  <div class="card">
    <input id="niche" placeholder="Nicho">
    <button class="generate" id="generateBtn">Gerar conteúdo com IA</button>
    <div id="loadingBox" style="display:none; margin-top:20px;">
      <div class="spinner"></div>
    </div>
  </div>

  <div class="result" id="result">
    <p id="ideaText"></p>
    <p id="copyText"></p>

    <div class="image-wrapper">
      <img id="imagePreview">
      <div class="watermark" id="watermark">Criado com Lyvra AI</div>
    </div>

    <div class="upgrade" id="upgradeBox">
      Você está no plano Free —
      <a href="/planos.html">fazer upgrade</a>
    </div>
  </div>

</div>

<script>
/* === UTIL === */
function getPlanFromURL() {
  return new URLSearchParams(window.location.search).get("plan");
}

/* === USUÁRIO === */
let uid = localStorage.getItem("lyvra_uid");
if (!uid) {
  uid = "uid_" + Math.random().toString(36).slice(2);
  localStorage.setItem("lyvra_uid", uid);
}

const planKey = `lyvra_plan_${uid}`;
const urlPlan = getPlanFromURL();

if (urlPlan) {
  localStorage.setItem(planKey, urlPlan);
}

const userPlan = localStorage.getItem(planKey) || "free";

/* === LIMITES === */
const limits = { free: 3, pro: 300, business: Infinity };

const now = new Date();
const monthKey = `${now.getFullYear()}-${now.getMonth()+1}`;
const usageKey = `lyvra_usage_${uid}_${monthKey}`;
let usageCount = parseInt(localStorage.getItem(usageKey)) || 0;

/* === HEADER === */
document.getElementById("user-plan").innerHTML =
  `Plano ${userPlan.toUpperCase()} • ${usageCount} / ${limits[userPlan] === Infinity ? "∞" : limits[userPlan]}`;

/* === WATERMARK === */
if (userPlan === "free") {
  document.getElementById("watermark").style.display = "block";
}

/* === GERAR === */
document.getElementById("generateBtn").onclick = async () => {
  if (usageCount >= limits[userPlan]) {
    document.getElementById("upgradeBox").style.display = "block";
    return;
  }

  document.getElementById("loadingBox").style.display = "block";
  await new Promise(r => setTimeout(r, 1500));

  document.getElementById("ideaText").innerText = "Ideia gerada";
  document.getElementById("copyText").innerText = "Legenda gerada";
  document.getElementById("imagePreview").src =
    "https://via.placeholder.com/600x600";

  usageCount++;
  localStorage.setItem(usageKey, usageCount);

  location.reload();
};

/* === BOTÕES === */
document.getElementById("logoutBtn").onclick = () => {
  localStorage.removeItem("lyvra_uid");
  window.location.href = "/index.html";
};

document.getElementById("upgradeBtn").onclick = () => {
  window.location.href = "/planos.html";
};
</script>

</body>
</html>
